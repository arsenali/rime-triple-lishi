# Rime schema
# encoding: utf-8

schema:
  schema_id: triple_lishi15
  name: 李氏三拼15键
  version: "0.1"
  author:
    - Rime程序    佛振 <chen.sst@gmail.com>
    # - Rime schema by 佛振 # <chen.sst@gmail.com>
    - 三拼方案    阿森納裡 <qq:15678407>
    # - triple pinyin schema by 阿森納裡 # <shyueyeuanlii@163.com>
  description: |
    在e-m的15鍵內實現“聲+介&調+韻”三碼一音，適合單手操作；
    聲母、韻母基本按正序排列；
    介母從上至下依次為“空、i、u/ü”；
    聲調從左至右依次為51234聲。
  dependencies:
    - stroke

switches:
  - name: ascii_mode
    reset: 0
    states: [ 中文, 西文 ]
  - name: full_shape
    states: [ 半角, 全角 ]
  - name: simplification
    states: [ 繁體, 简体 ]
  - name: ascii_punct
    states: [ ，。, ，． ]

engine:
  processors:
    - ascii_composer
    - recognizer
    - key_binder
    - speller
    - punctuator
    - selector
    - navigator
    - fluency_editor  # 語句流輸入
    # - express_editor  # 編輯器
    # - fluid_editor  # 句式編輯器
  segmentors:
    - ascii_segmentor
    - matcher
    - abc_segmentor
    - punct_segmentor
    - fallback_segmentor
  translators:
    # - echo_translator  # 沒有其他候選字時，回顯輸入碼
    - punct_translator
    - reverse_lookup_translator
    - script_translator
  filters:
    # - reverse_lookup_filter  # 反查濾鏡
    - simplifier
    - uniquifier

speller:
  alphabet: 'ertyudfghjcvbnm'
  delimiter: " '"
  algebra:
    - erase/^xx$/
    - xform/^m([1-5])$/mu$1/  # 鼻音m“呣”轉化爲mu
    - xform/\<r5$/er5/  # r5（兒）轉化爲er5
    - xform/^eh([1-5])$/e$1/  # eh（誒欸）與e合併，作模糊音處理
    - xform/^lvan([1-5])$/luan$1/  # lvan與luan合併，作模糊音處理
    - xform/^([jqx])u/$1v/
    # 拼音完整形式
    - xform/iu/iou/
    - xform/ui/uei/
    - xform/^yi?/i/
    - xform/^wu?/u/
    - xform/iu/v/
    - xform/([iuv])n/$1en/
    # 音節合併
    - xform/^iai([1-5])$/qiai$1/
    - xform/^er([1-5])$/iai$1/
    - xform/^ueng([1-5])$/ong$1/
    - xform/^fei([1-5])$/fi$1/
    - xform/^fu([1-5])$/fe$1/
    - xform/^f([aoe]\w*[1-5])$/fi$1/
    - xform/^([zcs]h?|r)i([1-5])$/$1o$2/
    - xform/^([zcs])h?ei([1-5])$/$1hei$2/
    - xform/^([zcs])([aoe]\w*[1-5])$/$1hi$2/
    - xform/^([zcs])uan([1-5])$/$1hi$2/
    - xform/^([zcs])u([1-5])$/$1hv$2/
    - xform/^([zcs])uei([1-5])$/$1hvan$2/
    - xform/^([zcs])uen([1-5])$/$1hven$2/
    - xform/^([zcs])uo([1-5])$/$1hve$2/
    - xform/^r([aoeu]\w*[1-5])$/f$1/
    
    - derive/^([a-z]+)[0-5]$/$1/
    
    # 第1碼：聲
    - xform/^b/R/
    - xform/^p/T/
    - xform/^m/Y/
    - xform/^[fr]/U/
    - xform/^d/F/
    - xform/^t/G/
    - xform/^n/H/
    - xform/^l/J/
    - xform/^[gj]/V/
    - xform/^[kq]/B/
    - xform/^[hx]/N/
    - xform/^([aeoiuv])/M$1/
    - xform/^zh?/E/
    - xform/^ch?/D/
    - xform/^sh?/C/
    # 第2碼：介+聲調
    - xform/^([RTYUEFGHJDVBNMC])([aeo]\w*)1$/$1R$2/
    - xform/^([RTYUEFGHJDVBNMC])([aeo]\w*)2$/$1T$2/
    - xform/^([RTYUEFGHJDVBNMC])([aeo]\w*)3$/$1Y$2/
    - xform/^([RTYUEFGHJDVBNMC])([aeo]\w*)4$/$1U$2/
    - xform/^([RTYUEFGHJDVBNMC])([aeo]\w*)5$/$1E$2/
    - xform/^([RTYUEFGHJDVBNMC])(i\w*)1$/$1F$2/
    - xform/^([RTYUEFGHJDVBNMC])(i\w*)2$/$1G$2/
    - xform/^([RTYUEFGHJDVBNMC])(i\w*)3$/$1H$2/
    - xform/^([RTYUEFGHJDVBNMC])(i\w*)4$/$1J$2/
    - xform/^([RTYUEFGHJDVBNMC])(i\w*)5$/$1D$2/
    - xform/^([RTYUEFGHJDVBNMC])([uv]\w*)1$/$1V$2/
    - xform/^([RTYUEFGHJDVBNMC])([uv]\w*)2$/$1B$2/
    - xform/^([RTYUEFGHJDVBNMC])([uv]\w*)3$/$1N$2/
    - xform/^([RTYUEFGHJDVBNMC])([uv]\w*)4$/$1M$2/
    - xform/^([RTYUEFGHJDVBNMC])([uv]\w*)5$/$1C$2/
    # 第3碼：韻
    - xform/^([RTYUEFGHJDVBNMC]{2})(a|ia|ua)$/$1R/
    - xform/^([RTYUEFGHJDVBNMC]{2})(ai|iai|uai)$/$1T/
    - xform/^([RTYUEFGHJDVBNMC]{2})(an|ian|uan)$/$1Y/
    - xform/^([RTYUEFGHJDVBNMC]{2})(ang|iang|uang)$/$1U/
    - xform/^([RTYUEFGHJDVBNMC]{2})(e|ie|u)$/$1F/
    - xform/^([RTYUEFGHJDVBNMC]{2})(ei|i|uei)$/$1G/
    - xform/^([RTYUEFGHJDVBNMC]{2})(en|ien|uen)$/$1H/
    - xform/^([RTYUEFGHJDVBNMC]{2})(eng|ieng|uo)$/$1J/
    - xform/^([RTYUEFGHJDVBNMC]{2})(o|io|v)$/$1V/
    - xform/^([RTYUEFGHJDVBNMC]{2})(ao|iao|van)$/$1B/
    - xform/^([RTYUEFGHJDVBNMC]{2})(ou|iou|ven)$/$1N/
    - xform/^([RTYUEFGHJDVBNMC]{2})(ong|iong|ve)$/$1M/
    
    - erase/^[RTYUEFGHJDVBNMC][a-z]+/
    - xlit/QWERTYUIOPASDFGHJKLZXCVBNM/qwertyuiopasdfghjklzxcvbnm/
    # - abbrev/^(.)..$/$1/
    # - abbrev/^(..).$/$1/
    # - abbrev/^(.).(.)$/$1$2/

translator:
  dictionary: terra_pinyin
  prism: triple_lishi15
  spelling_hints: 5 # ～字以內候選標註完整帶調拼音
  preedit_format:
   # 第1步：輸入碼轉化爲漢語拼音
    # 第1碼：聲
    - xform/\<r(\w*)/B$1/
    - xform/\<t(\w*)/P$1/
    - xform/\<y(\w*)/M$1/
    - xform/\<u(\w+)/R$1/
    - xform/\<f(\w*)/D$1/
    - xform/\<g(\w*)/T$1/
    - xform/\<h(\w*)/N$1/
    - xform/\<j(\w*)/L$1/
    - xform/\<v(\w+)/G$1/
    - xform/\<b(\w+)/K$1/
    - xform/\<n(\w+)/H$1/
    - xform/\<m(\w+)/Y$1/
    - xform/\<e(\w+)/Z$1/
    - xform/\<d(\w+)/C$1/
    - xform/\<c(\w+)/S$1/
    - xform/\<u\>/F|R/
    - xform/\<v\>/G|J/
    - xform/\<b\>/K|Q/
    - xform/\<n\>/H|X/
    - xform/\<m\>/'|Y|W/
    - xform/\<e\>/ZH|Z/
    - xform/\<d\>/CH|C/
    - xform/\<c\>/SH|S/
    # 第2碼：介+聲調
    - xform/\<([BPMRDTNLGKHYZCS])r([a-z]|\>)/$1O$2\x31/
    - xform/\<([BPMRDTNLGKHYZCS])t([a-z]|\>)/$1O$2\x32/
    - xform/\<([BPMRDTNLGKHYZCS])y([a-z]|\>)/$1O$2\x33/
    - xform/\<([BPMRDTNLGKHYZCS])u([a-z]|\>)/$1O$2\x34/
    - xform/\<([BPMRDTNLGKHYZCS])e([a-z]|\>)/$1O$2\x35/
    - xform/\<([BPMRDTNLGKHYZCS])f([a-z]|\>)/$1I$2\x31/
    - xform/\<([BPMRDTNLGKHYZCS])g([a-z]|\>)/$1I$2\x32/
    - xform/\<([BPMRDTNLGKHYZCS])h([a-z]|\>)/$1I$2\x33/
    - xform/\<([BPMRDTNLGKHYZCS])j([a-z]|\>)/$1I$2\x34/
    - xform/\<([BPMRDTNLGKHYZCS])d([a-z]|\>)/$1I$2\x35/
    - xform/\<([BPMRDTNLGKHYZCS])v([a-z]|\>)/$1U$2\x31/
    - xform/\<([BPMRDTNLGKHYZCS])b([a-z]|\>)/$1U$2\x32/
    - xform/\<([BPMRDTNLGKHYZCS])n([a-z]|\>)/$1U$2\x33/
    - xform/\<([BPMRDTNLGKHYZCS])m([a-z]|\>)/$1U$2\x34/
    - xform/\<([BPMRDTNLGKHYZCS])c([a-z]|\>)/$1U$2\x35/
    - xform/\<RI([1-5])\>/FO$1/
    - xform/\<([NL])U([1-5])\>/$1U$2|$1V$2/
    - xform/\<GI([1-5])\>/JI$1/
    - xform/\<KI([1-5])\>/QI$1/
    - xform/\<HI([1-5])\>/XI$1/
    - xform/\<GU([1-5])\>/GU$1|JU$1/
    - xform/\<KU([1-5])\>/KU$1|QU$1/
    - xform/\<HU([1-5])\>/HU$1|XU$1/
    - xform/\<YO([1-5])\>/'O$1/
    - xform/\<YI([1-5])\>/YO$1|ER$1/
    - xform/\<YU([1-5])\>/W$1|YU$1/
    - xform/\<([ZCS])O([1-5])\>/$1HO$2/
    - xform/\<([ZCS])I([1-5])\>/$1O$2/
    - xform/\<([ZCS])U([1-5])\>/$1HU$2|$1U$2/
    - xform/([OIUVW][1-5])\>/$1-/
    - xform/O//
    # 第3碼：韻
    # 可能衝突的小寫字母共有6個(ingoue)，用希臘字母處突
    - xform/\<([BPMRDTNLGKHYZCS][IUV]?)r([1-5])\>/$1A$2/
    - xform/\<([BPMRDTNLGKHYZCS][IUV]?)t([1-5])\>/$1Aα$2/
    - xform/\<([BPMRDTNLGKHYZCS][IUV]?)y([1-5])\>/$1Aβ$2/
    - xform/\<([BPMRDTNLGKHYZCS][IUV]?)u([1-5])\>/$1Aβγ$2/
    - xform/\<([BPMRDTNLGKHYZCS][IUV]?)f([1-5])\>/$1E$2/
    - xform/\<([BPMRDTNLGKHYZCS])UE([1-5])\>/$1U$2/
    - xform/\<([BPMRDTNLGKHYZCS][IUV]?)g([1-5])\>/$1Eα$2/
    - xform/\<([BPMRDTNLGKHYZCS])IEα([1-5])\>/$1I$2/
    - xform/\<([BPMRDTNLGKHYZCS][IUV]?)h([1-5])\>/$1Eβ$2/
    - xform/\<([BPMRDTNLGKHYZCS][IUV]?)j([1-5])\>/$1Eβγ$2/
    - xform/\<([BPMRDTNLGKHYZCS])UEβγ([1-5])\>/$1Uδ$2/
    - xform/\<([BPMRDTNLGKHYZCS][IUV]?)v([1-5])\>/$1O$2/
    - xform/\<([BPMRDTNLGKHYZCS])UO([1-5])\>/$1V$2/
    - xform/\<([BPMRDTNLGKHYZCS][IUV]?)b([1-5])\>/$1Aδ$2/
    - xform/\<([BPMRDTNLGKHYZCS])UAδ([1-5])\>/$1VAβ$2/
    - xform/\<([BPMRDTNLGKHYZCS][IUV]?)n([1-5])\>/$1Oε$2/
    - xform/\<([BPMRDTNLGKHYZCS])UOε([1-5])\>/$1VEβ$2/
    - xform/\<([BPMRDTNLGKHYZCS][IUV]?)m([1-5])\>/$1Oβγ$2/
    - xform/\<([BPMRDTNLGKHYZCS])UOβγ([1-5])\>/$1Vζ$2/
    - xlit/αβγδεζ/ingoue/
    
    - xform/\<YIAi([1-5])\>/er$1/
    - xform/\<KIAi([1-5])\>/YIAi$1/
    - xform/\<YOng([1-5])\>/YUeng$1/
    - xform/\<RIAo(\w*[1-5])\>/Fiao$1/
    - xform/\<RI([1-5])\>/Fei$1/
    - xform/\<RI(\w+[1-5])\>/F$1/
    - xform/\<FE([1-5])\>/Fu$1/
    - xform/\<G([IV]\w*[1-5])\>/J$1/
    - xform/\<K([IV]\w*[1-5])\>/Q$1/
    - xform/\<H([IV]\w*[1-5])\>/X$1/
    - xform/\<([ZCS])([AOEU]\w*[1-5])( |$)/$1h$2$3/
    - xform/\<([ZCS]h|R)O([1-5])\>/$1i$2/
    - xform/\<([ZCS])IO([1-5])\>/$1i$2/
    - xform/\<([ZC])hEi([1-5])\>/$1ei$2/
    - xform/\<([ZCS])I([1-5])\>/$1uan$2/
    - xform/\<([ZCS])I(\w+[1-5])\>/$1$2/
    - xform/\<([ZCS])V([1-5])\>/$1u$2/
    - xform/\<([ZCS])VAn([1-5])\>/$1uei$2/
    - xform/\<([ZCS])VEn([1-5])\>/$1uen$2/
    - xform/\<([ZCS])Ve([1-5])\>/$1uo$2/
    
    - xlit/QWERTYUIOPASDFGHJKLZXCVBNM/qwertyuiopasdfghjklzxcvbnm/
    # 拼音完整形式
    - xform/\<([jqx])v/$1u/
    - xform/\<y([aoe])/$1/
    - xform/([iuv])en/$1n/
    - xform/([^y])iou/$1iu/
    - xform/\<yi([aoe])/y$1/
    - xform/uei/ui/
    - xform/\<yu([1-5])( |$)/wu$1$2/
    - xform/\<yu([aoe])/w$1/
    - xform/\<yu([in])/we$1/
    - xform/\<yv/yu/
    
    - xform ([aeiou])(ng?|r)([1234]) $1$3$2
    - xform ([aeo])([iuo])([1234]) $1$3$2
    - xform vn([1234]) v$1n
    - xform a1 ā
    - xform a2 á
    - xform a3 ǎ
    - xform a4 à
    - xform e1 ē
    - xform e2 é
    - xform e3 ě
    - xform e4 è
    - xform o1 ō
    - xform o2 ó
    - xform o3 ǒ
    - xform o4 ò
    - xform i1 ī
    - xform i2 í
    - xform i3 ǐ
    - xform i4 ì
    - xform u1 ū
    - xform u2 ú
    - xform u3 ǔ
    - xform u4 ù
    - xform v1 ǖ
    - xform v2 ǘ
    - xform v3 ǚ
    - xform v4 ǜ
    - xform/([nljqxyzcs])v/$1ü/
    - xlit/1234/ˉˊˇˋ/
    - xform/\<([a-z]h?)5/$1˙/
    - xform/5//
    
  comment_format:  # 提示碼爲带调拼音
    - xform ([aeiou])(ng?|r)([1234]) $1$3$2
    - xform ([aeo])([iuo])([1234]) $1$3$2
    - xform vn([1234]) v$1n
    - xform a1 ā
    - xform a2 á
    - xform a3 ǎ
    - xform a4 à
    - xform e1 ē
    - xform e2 é
    - xform e3 ě
    - xform e4 è
    - xform o1 ō
    - xform o2 ó
    - xform o3 ǒ
    - xform o4 ò
    - xform i1 ī
    - xform i2 í
    - xform i3 ǐ
    - xform i4 ì
    - xform u1 ū
    - xform u2 ú
    - xform u3 ǔ
    - xform u4 ù
    - xform v1 ǖ
    - xform v2 ǘ
    - xform v3 ǚ
    - xform v4 ǜ
    - xform eh1 ê̄
    - xform eh2 ế
    - xform eh3 ê̌
    - xform eh4 ề
    - xform/eh5?/ê/
    - xform/([nljqxyzcs])v/$1ü/
    - xform/([a-z|ü]+)[1-5]/$1/

reverse_lookup:
  dictionary: stroke
  enable_completion: true  # 提前顯示尚未輸入完整碼的字〔僅table_translator有效〕
  prefix: "`"
  suffix: "'"
  tips: 〔筆畫〕
  preedit_format:
    - xlit/hspnz/一丨丿丶乙/
  comment_format:
    - xform ([aeiou])(ng?|r)([1234]) $1$3$2
    - xform ([aeo])([iuo])([1234]) $1$3$2
    - xform vn([1234]) v$1n
    - xform a1 ā
    - xform a2 á
    - xform a3 ǎ
    - xform a4 à
    - xform e1 ē
    - xform e2 é
    - xform e3 ě
    - xform e4 è
    - xform o1 ō
    - xform o2 ó
    - xform o3 ǒ
    - xform o4 ò
    - xform i1 ī
    - xform i2 í
    - xform i3 ǐ
    - xform i4 ì
    - xform u1 ū
    - xform u2 ú
    - xform u3 ǔ
    - xform u4 ù
    - xform v1 ǖ
    - xform v2 ǘ
    - xform v3 ǚ
    - xform v4 ǜ
    - xform eh1 ê̄
    - xform eh2 ế
    - xform eh3 ê̌
    - xform eh4 ề
    - xform/eh5?/ê/
    - xform/([nljqxyzcs])v/$1ü/
    - xform/([a-z|ü]+)[1-5]/$1/

punctuator:
  import_preset: default

key_binder:
  import_preset: default
  bindings:
    - { accept: Return, send: "Shift+Return", when: composing }
    - { accept: "Shift+Return", send: Return, when: composing }
    
    # - { accept: minus, send: minus, when: has_menu }
    # - { accept: minus, send: Page_Up, when: paging }
    # - { accept: minus, send: Page_Up, when: has_menu }
    # - { accept: equal, send: Page_Down, when: has_menu }
    
    - { accept: comma, send: comma, when: paging }
    # - { accept: comma, send: Page_Up, when: paging }
    - { accept: period, send: period, when: has_menu }
    # - { accept: period, send: Page_Down, when: has_menu }
    
    # - { accept: semicolon, send: 2, when: has_menu }
    # - { accept: apostrophe, send: 3, when: has_menu }
    
    - {accept: "Control+Shift+5", toggle: ascii_punct, when: always}
    - {accept: "Control+Shift+percent", toggle: ascii_punct, when: always}
    
    - {accept: "Control+Shift+F", toggle: simplification, when: always}

recognizer:
  import_preset: default
  patterns:
    email: "^[A-Za-z][-_.0-9A-Za-z]*@.*$"
    uppercase: "[A-Z][-_+.'0-9A-Za-z]*$"
    url: "^(www[.]|https?:|ftp[.:]|mailto:|file:).*$|^[a-z]+[.].+$"

    punct: '^/([0-9]0?|[A-Za-z]+)$'
    reverse_lookup: "`[a-z]*'?$"
